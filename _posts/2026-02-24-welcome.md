---
layout: post
title: "Welcome - HackSmarter (WriteUp)"
date: 2026-02-24
categories: writeups
---

Escopo : welcome.local
# Introdução

Sou um membro do Hack Smarter Red Team. E fomos contratados para testar a infraestrutura critica do cliente. Como uma operação de red team, precisamos nos enfiltrar de forma iguall um insider faria.

Durante um envolvimento de phishing, consegui recuperar credenciais para o ambiente Active Directory do cliente. Vou usar essas credenciais para enumerar o ambiente, elevar meus privilégios e demonstrar impacto para o cliente.

e.hills : Il0vemyj0b2025!

# Reconnaissance

Primeira coisa que posso fazer é tentar verificar na rede quantos hosts ativos respondem ao ICMP.

<img width="865" height="275" alt="image" src="https://github.com/user-attachments/assets/2a0658c2-0952-480c-8c43-08f7aad7e113" />

Certo, tenho apenas um alvo, então para continuar a enumeração, vou fazer um scan. Vou usar o rustscan para verificar as portas abertas no alvo. Usarei usando as seguintes flags:

-sV → verifica a versão do serviço rodando na porta

-sC → verifica o script padrão para o serviço que esta rodando

<img width="1006" height="416" alt="image" src="https://github.com/user-attachments/assets/09078bcd-d82b-4050-9d48-39c97394999d" />

Vamos verificar os pontos fortes dessa saida.

88/tcp open kerberos-sec syn-ack Microsoft Windows Kerberos (server time: 2025-12-15 02:05:20Z)

389/tcp open ldap syn-ack Microsoft Windows Active Directory LDAP (Domain: WELCOME.local0., Site: Default-First-Site-Name) Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows.

<img width="724" height="286" alt="image" src="https://github.com/user-attachments/assets/89fc505d-7dbb-47d0-a9d5-5908f026093e" />

Alguns pontos interessantes. Antes de qualquer coisa, salvar o dominio no arquivo hosts, para que o ip do alvo seja traduzido localmente na minha máquina.

Como tenho um credencial, resolvi verificar se ela é válida no dominio, para confirmar isso, uso netexec.

<img width="954" height="159" alt="image" src="https://github.com/user-attachments/assets/d8b79af5-0754-4810-b760-17cf700649b1" />

Com a credencial validada na rede do alvo, hora de verificar se tenho acesso há algum arquivo compartilhado na rede.

A ferramenta netexec com flag smb e com credenciais validadas pode ser usada para isso.

<img width="946" height="353" alt="image" src="https://github.com/user-attachments/assets/1b215f1b-ca00-486a-8e67-cc5780ff7e00" />

No print acima, mostra que no smb tem um arquivo interessante compartilhado chamado human resources.

Para ter acesso esse compartilhamento, foi ultilizado o smbclient.

O smbclient é uma ferramenta de linha de comando que fornece funcionalidade de cliente de protocolo SMB/CIFS, semelhante a um cliente FTP. Ele faz parte do pacote Samba e permite que os usuários acessem compartilhamentos do Windows, transfiram arquivos e interajam com servidores SMB de sistemas Linux e Unix.

Já que tenho uma credencial validada no Active Directory, vou usar ela para para acessar o diretório interessado.

<img width="969" height="424" alt="image" src="https://github.com/user-attachments/assets/dc3fd799-9e06-41c2-a4a7-ca34b60dd9ff" />

Vou baixar eles para minha máquina local usando o comando wget*.

Já na minha máquina analisando os arquivos, nada foi encontrado, porém tem um que esta pedindo senha, para quebrar essa senha vou ultilizar o john.

Mas antes precisei usar o pdf2john, esse ultilitário do john the ripper, serve apenas para converter o PDF em um formato de hash que o john consegue atacar.

Logo após foi preciso apenas usar o john com a worlist rockyou para, enfim, ter a senha que dar acesso ao conteúdo do pdf.

<img width="950" height="408" alt="image" src="https://github.com/user-attachments/assets/46959d51-a03f-4827-8a41-2f12191da778" />

Parece que tenho uma senha, enviada para uma funcionário novo. Mas também tenho o que parece ser alguns outros usuários. password: Welcome2025

Mesmo com a senha, ainda é preciso um usuário para ela. Usando o netexec e o smb, pode usar a flag - - users para enumerar os usuários do AD.

<img width="940" height="231" alt="image" src="https://github.com/user-attachments/assets/32853957-12f0-40a4-9c1e-a320a3f9703d" />

E assim a enumeração dos usuários foi feita. Para prosseguir nessa enumeração e confirmar de quem é a senha que foi obtida anteriormente. Foi salvo os usuários em um arquivo na máquina local e usando próprio netexec para fazer um passworspray (técnica que usa uma senha com vários usuários até que se descubra o usuário que ultiliza ela para se autenticar).

<img width="951" height="157" alt="image" src="https://github.com/user-attachments/assets/d1bf7d37-3dc5-4695-a66b-512cb6e0e434" />

Também foi validado o usuário no AD com a própria ferramenta netexec. Mas dessa vez usando o ldap para validar.

a.harris:Welcome2025!@

<img width="950" height="159" alt="image" src="https://github.com/user-attachments/assets/206e4ff2-fe7c-4859-88c6-c7ec0da5d617" />

O WinRM (Windows Remote Management) é o serviço/protocolo do Windows que permite administração remota de máquinas Windows usando WS-Management (SOAP sobre HTTP/HTTPS).

Para verificar se o usuário a.harris pode ter esse acesso, uso o netexec.

<img width="949" height="147" alt="image" src="https://github.com/user-attachments/assets/d4c99e2c-4798-4c59-b97f-7cede6b7aebc" />

# Lateral Movement

Para usar o winrm para esse movimento lateral, vou ultilizar a ferramenta Evil-Winrm com as credenciais validadas ao acesso.

<img width="783" height="328" alt="image" src="https://github.com/user-attachments/assets/6f2220a3-7f2d-4614-ad10-7ac04212883e" />

E assim, o acesso a rede do alvo foi feita. E a primeira flag foi encontrada.

<img width="757" height="769" alt="image" src="https://github.com/user-attachments/assets/a3579aa5-e679-4b34-84dc-5fae1d120439" />

Logo após coletada a flag, nada foi encontrado diante da enumeração do alvo. Então precisava ser feita um novo movimento lateral. Mas para esse movimento lateral ser realizado foi ultilizado o bloodhound, porém antes tinha que ser coletado os dados para o bloodhound analisar.

E mais uma vez a ferramenta netexec foi ultilizada

<img width="955" height="284" alt="image" src="https://github.com/user-attachments/assets/a194730e-60f6-4fca-8b89-0f718d4ab041" />

Agora foi iniciado o bloodhound para ter uma visão melhor da infraestrutura do alvo.

<img width="914" height="323" alt="image" src="https://github.com/user-attachments/assets/ee1b8d0c-95b0-4b1c-96e4-d244029268e4" />

Como podemos ver, o usuário comprometido tem uma permisão de generic all sobre o usuário I.PARK. GenericAll = pode:

Resetar senha

Alterar atributos

Adicionar SPN

Habilitar Kerberoast

Configurar Shadow Credentials

Basicamente tomar a conta Usando

A ferramenta bloodAD pode ser ultilizada para forçar a mudança da senha desse novo usuário. E com o comando python3 bloodyAD.py --host 10.1.129.172 -d welcome.local -u a.harris -p 'Welcome2025!@' set password I.PARK 'Admin123@' posso explorar e criar uma nova senha para o usuário.

<img width="892" height="100" alt="image" src="https://github.com/user-attachments/assets/3287e081-62ff-437d-9963-028c31d331ed" />

Na saída do comando, mostra que foi sucesso a alteração da senha do usuário. Hora de validar se foi feita.

<img width="903" height="118" alt="image" src="https://github.com/user-attachments/assets/5740932e-a235-4028-9686-3e703f370434" />


Validada o novo movimento lateral, hora de ir para o bloodhound verificar o caminho para o compromentimento da rede do alvo.

<img width="900" height="279" alt="image" src="https://github.com/user-attachments/assets/1b41b8a1-20f4-46d5-ad72-2e07b3d86755" />

O usuário comprometido faz parte do grupo helpdesk, que tem a permissão subvenções o direito de alterar a senha de um conta de usuário sem saber sua senha atual.

Ultilizando o mesmo caminho, foi ultilizado o bloodAD para esse movimento lateral.

<img width="1001" height="128" alt="image" src="https://github.com/user-attachments/assets/ba245026-e5b8-4703-a336-c8c3223e5e3e" />

E confirmo as credenciais usando o netexec.

<img width="1001" height="145" alt="image" src="https://github.com/user-attachments/assets/4be79bb9-50a3-41ab-9fd8-8b42a994d3ab" />

Certo, o usuário svc_ca é um usuário de serviço ligada à Autoridade Certificadora (CA). Posso tentar enumerar o AD usando ele. O Certify com a flag find é usado para enumerar vulnerabilidades na infraestrutura de certificados do Active Directory (AD CS).

<img width="1005" height="393" alt="image" src="https://github.com/user-attachments/assets/069e9db7-eb47-40ce-9cb5-0a1ef3c229b3" />

A ferramenta certipy mostra na saída que o alvo é vulnerável a esc1

<img width="913" height="214" alt="image" src="https://github.com/user-attachments/assets/533e7afa-5821-42b0-93b6-ed9e2d2b058e" />

Para explorar esse tipo de vulnerabilidade, preciso do SID do alvo. O lookupsid pode ajudar nisso.

<img width="1006" height="234" alt="image" src="https://github.com/user-attachments/assets/203c05b4-7190-40ae-b6bd-d1c02f46e7bd" />

Como ja esta em mãos o SID do dominio, preciso apenas setar o sidTypeUser que é um tipo de SID (Security Identifier) que indica que aquele SID pertence a um usuário no Windows / Active Directory.

No caso, vai ser preciso setar o do administrator (500).

<img width="999" height="413" alt="image" src="https://github.com/user-attachments/assets/833c7865-4774-470d-a94c-9868e49ef0c2" />

Como pode ser visto no print acima, foi obtido um certificado que pode ser usado para autenticação Kerberos. E logo depois foi ultilizado o certificado para ter um sessão válida como o usuário comprometido (administrator). E por fim, recebo o NT hash do usuário.

Já que tenho uma hash, posso ultilizar o evil-wirm para fazer um pass-the-hash, ou seja, vou usar a própria hash como credencial, em vez da senha.

<img width="994" height="195" alt="image" src="https://github.com/user-attachments/assets/5d5212d8-bade-44f7-9921-0687a9a599d6" />

Como foi feito a elevação de privilégios, hora de buscar pela flag do root.

<img width="929" height="423" alt="image" src="https://github.com/user-attachments/assets/6a1594fd-be94-4943-b3af-df955a3dca35" />

Essa operação reforçou, na prática, como erros de configuração, senhas fracas, ACLs mal atribuídas e serviços críticos mal protegidos, como AD CS, podem ser combinados em uma cadeia de ataque completa. Foi uma experiência valiosa para aprofundar conhecimentos em enumeração, análise de relacionamentos no AD e exploração de vulnerabilidades modernas, destacando a importância de hardening, monitoramento contínuo e boas práticas de segurança em ambientes corporativos.

# ROMANOS 11:36



